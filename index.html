<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puzzle Game</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      color: white;
      margin-bottom: 24px;
      font-size: 36px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 24px;
      align-items: center;
      justify-content: center;
    }

    label {
      color: white;
      font-weight: bold;
      font-size: 16px;
    }

    button, select, input[type="file"] {
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 14px;
      border: none;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: all 0.2s;
      background: white;
      color: #333;
      cursor: pointer;
    }

    button:hover, select:hover {
      background: #e8e8e8;
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    select {
      min-width: 100px;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 20px;
      padding-right: 32px;
    }

    #puzzle-container {
      position: relative;
      width: 90vw;
      max-width: 500px;
      aspect-ratio: 1 / 1;
      background: white;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      margin-bottom: 20px;
      touch-action: none;
    }

    .puzzle-piece {
      position: absolute;
      background-repeat: no-repeat;
      background-size: cover;
      border: 1px solid rgba(0,0,0,0.1);
      user-select: none;
      cursor: grab;
      transition: box-shadow 0.1s;
    }

    .puzzle-piece:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .puzzle-piece.dragging {
      cursor: grabbing;
      opacity: 0.85;
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      z-index: 100 !important;
    }

    #status {
      color: white;
      font-weight: bold;
      font-size: 20px;
      min-height: 30px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      text-align: center;
    }

    #error-message {
      color: #ffcccc;
      font-size: 14px;
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ðŸ§© Puzzle Game</h1>
  
  <div class="controls">
    <label for="level">Level:</label>
    <select id="level">
      <option value="1">Image 1</option>
      <option value="2">Image 2</option>
      <option value="3">Image 3</option>
      <option value="4">Image 4</option>
      <option value="5">Image 5</option>
      <option value="6">Image 6</option>
      <option value="7">Image 7</option>
      <option value="8">Image 8</option>
      <option value="9">Image 9</option>
      <option value="10">Image 10</option>
    </select>

    <label for="size">Grid Size:</label>
    <select id="size">
      <option value="2">2 x 2</option>
      <option value="3" selected>3 x 3</option>
      <option value="4">4 x 4</option>
      <option value="5">5 x 5</option>
    </select>

    <button id="shuffle">Shuffle</button>
    <button id="newGame">New Game</button>

    <span style="color: white; font-weight: bold;">or</span>

    <input type="file" id="imageUpload" accept="image/*" title="Upload custom image">
  </div>

  <div id="puzzle-container"></div>
  <div id="status"></div>
  <div id="error-message"></div>

  <script>
    const container = document.getElementById("puzzle-container");
    const levelSelector = document.getElementById("level");
    const sizeSelector = document.getElementById("size");
    const imageInput = document.getElementById("imageUpload");
    const shuffleButton = document.getElementById("shuffle");
    const newGameButton = document.getElementById("newGame");
    const statusDiv = document.getElementById("status");
    const errorDiv = document.getElementById("error-message");

    let imageSrc = getImagePath();
    let size = Number(sizeSelector.value);
    let pieces = [];
    let draggedIndex = null;
    let offsetX = 0;
    let offsetY = 0;

    // Get image path from images folder
    function getImagePath() {
      return "images/" + levelSelector.value + ".png";
    }

    // Change level (load different image)
    levelSelector.addEventListener("change", () => {
      imageSrc = getImagePath();
      createPuzzle();
      errorDiv.textContent = '';
    });

    // Change grid size
    sizeSelector.addEventListener("change", () => {
      size = Number(sizeSelector.value);
      createPuzzle();
    });

    // Upload custom image
    imageInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (evt) => {
          imageSrc = evt.target.result;
          createPuzzle();
        };
        reader.readAsDataURL(file);
      }
    });

    // Shuffle button
    shuffleButton.addEventListener("click", () => {
      pieces = shuffleArray(pieces);
      drawPuzzle();
      statusDiv.textContent = '';
    });

    // New game button
    newGameButton.addEventListener("click", createPuzzle);

    // Create puzzle
    function createPuzzle() {
      container.innerHTML = "";
      statusDiv.textContent = '';
      pieces = [];

      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          pieces.push({ x, y });
        }
      }

      pieces = shuffleArray(pieces);
      drawPuzzle();
    }

    // Draw puzzle on screen
    function drawPuzzle() {
      const containerSize = container.clientWidth;
      const pieceSize = containerSize / size;
      container.innerHTML = "";

      pieces.forEach((piece, index) => {
        const div = document.createElement("div");
        div.className = "puzzle-piece";
        
        div.style.width = pieceSize + "px";
        div.style.height = pieceSize + "px";
        div.style.left = ((index % size) * pieceSize) + "px";
        div.style.top = (Math.floor(index / size) * pieceSize) + "px";
        
        div.style.backgroundImage = "url('" + imageSrc + "')";
        div.style.backgroundSize = containerSize + "px " + containerSize + "px";
        div.style.backgroundPosition = 
          (-piece.x * pieceSize) + "px " + (-piece.y * pieceSize) + "px";

        div.dataset.index = index;

        // Mouse and Touch events
        div.addEventListener("mousedown", startDrag);
        div.addEventListener("touchstart", startDrag, false);

        container.appendChild(div);
      });

      document.addEventListener("mousemove", moveDrag, false);
      document.addEventListener("touchmove", moveDrag, false);
      document.addEventListener("mouseup", endDrag, false);
      document.addEventListener("touchend", endDrag, false);
    }

    // Start dragging
    function startDrag(e) {
      draggedIndex = Number(e.target.dataset.index);
      const rect = e.target.getBoundingClientRect();
      const clientX = e.clientX || (e.touches && e.touches[0].clientX);
      const clientY = e.clientY || (e.touches && e.touches[0].clientY);
      
      offsetX = clientX - rect.left;
      offsetY = clientY - rect.top;
      
      e.target.classList.add("dragging");
    }

    // Move while dragging
    function moveDrag(e) {
      if (draggedIndex === null) return;

      const piece = document.querySelector("[data-index='" + draggedIndex + "']");
      if (!piece) return;

      e.preventDefault();
      const clientX = e.clientX || (e.touches && e.touches[0].clientX);
      const clientY = e.clientY || (e.touches && e.touches[0].clientY);
      
      const containerRect = container.getBoundingClientRect();
      let x = clientX - containerRect.left - offsetX;
      let y = clientY - containerRect.top - offsetY;

      x = Math.max(0, Math.min(x, containerRect.width - piece.offsetWidth));
      y = Math.max(0, Math.min(y, containerRect.height - piece.offsetHeight));

      piece.style.left = x + "px";
      piece.style.top = y + "px";
    }

    // End dragging
    function endDrag(e) {
      if (draggedIndex === null) return;

      const piece = document.querySelector("[data-index='" + draggedIndex + "']");
      if (!piece) {
        draggedIndex = null;
        return;
      }

      piece.classList.remove("dragging");

      const containerSize = container.clientWidth;
      const pieceSize = containerSize / size;
      
      const x = parseFloat(piece.style.left);
      const y = parseFloat(piece.style.top);
      
      const newCol = Math.round(x / pieceSize);
      const newRow = Math.round(y / pieceSize);
      const newIndex = newRow * size + newCol;
      
      if (newIndex >= 0 && newIndex < pieces.length && newIndex !== draggedIndex) {
        swapPieces(draggedIndex, newIndex);
      } else {
        drawPuzzle();
      }
      
      draggedIndex = null;
      checkVictory();
    }

    // Swap two pieces
    function swapPieces(i, j) {
      const temp = pieces[i];
      pieces[i] = pieces[j];
      pieces[j] = temp;
      drawPuzzle();
    }

    // Shuffle array
    function shuffleArray(array) {
      const shuffled = array.slice();
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // Check if puzzle is completed
    function checkVictory() {
      let isWin = true;
      for (let i = 0; i < pieces.length; i++) {
        const correctX = i % size;
        const correctY = Math.floor(i / size);
        if (pieces[i].x !== correctX || pieces[i].y !== correctY) {
          isWin = false;
          break;
        }
      }

      if (isWin) {
        statusDiv.textContent = "SUCCESS! Puzzle completed!";
        setTimeout(() => {
          if (confirm("Great job! Try next level?")) {
            const currentLevel = Number(levelSelector.value);
            if (currentLevel < 10) {
              levelSelector.value = (currentLevel + 1).toString();
              imageSrc = getImagePath();
              createPuzzle();
              errorDiv.textContent = '';
            } else {
              statusDiv.textContent = "All levels completed!";
            }
          }
        }, 600);
      }
    }

    // Handle window resize
    window.addEventListener("resize", drawPuzzle);

    // Initialize game
    createPuzzle();
  </script>
</body>
</html>
