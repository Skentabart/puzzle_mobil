<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–∞–∑–ª-–∏–≥—Ä–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    
    h2 { 
      margin: 20px 0 0 0; 
    }
    
    #game {
      position: relative;
      width: 95vw;
      max-width: 500px;
      aspect-ratio: 1/1;
      margin-top: 16px;
      border-radius: 12px;
      overflow: hidden;
      background: #333;
      box-shadow: 0 4px 12px #0004;
    }
    
    #imageLayer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      filter: blur(18px);
      z-index: 1;
      transition: filter 1.2s ease-out;
    }
    
    .piece {
      position: absolute;
      background-size: 100% 100%;
      background-repeat: no-repeat;
      border-radius: 6px;
      box-shadow: 0 0 6px #0008;
      cursor: grab;
      z-index: 2;
      user-select: none;
      touch-action: none;
    }
    
    .piece:active {
      cursor: grabbing;
      z-index: 10;
    }
    
    button {
      margin-top: 10px;
      margin-bottom: 20px;
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #2962ff;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 8px #0002;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #0039cb;
    }
    
    button:active {
      transform: scale(0.98);
    }
  </style>
</head>
<body>
  <h2>üß© –ü–∞–∑–ª-–∏–≥—Ä–∞</h2>
  <button id="newGameBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
  
  <div id="game">
    <div id="imageLayer"></div>
  </div>

  <script>
    // ===== –ù–ê–°–¢–†–û–ô–ö–ò =====
    const GRID_SIZE = 3;              // 3x3 = 9 —á–∞—Å—Ç–µ–π
    const SNAP_DISTANCE = 28;         // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø—Ä–∏–ª–∏–ø–∞–Ω–∏—è
    const IMAGES_FOLDER = 'images/';  // –ø–∞–ø–∫–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏
    const NUM_IMAGES = 10;            // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ (1.jpg - 10.jpg)

    // ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ =====
    let pieces = [];
    let activePiece = null;
    let offsetX = 0;
    let offsetY = 0;

    // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
    const newGameBtn = document.getElementById('newGameBtn');
    newGameBtn.addEventListener('click', startGame);

    // –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', startGame);

    // ===== –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø - –°–¢–ê–†–¢ –ò–ì–†–´ =====
    function startGame() {
      // –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–∞–∑–ª—ã
      pieces = [];
      activePiece = null;
      document.querySelectorAll('.piece').forEach(el => el.remove());

      // –í—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      const imageList = [];
      for(let i = 1; i <= NUM_IMAGES; i++) {
        imageList.push(`${IMAGES_FOLDER}${i}.jpg`);
      }
      const randomImage = imageList[Math.floor(Math.random() * imageList.length)];

      // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      const img = new Image();
      img.src = randomImage;

      img.onerror = () => {
        console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${randomImage}`);
        alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–ø–∫–∞ images/ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ (1.jpg - 10.jpg)');
      };

      img.onload = () => {
        createPuzzle(randomImage);
      };
    }

    // ===== –°–û–ó–î–ê–ù–ò–ï –ü–ê–ó–õ–ê =====
    function createPuzzle(imageSrc) {
      const gameDiv = document.getElementById('game');
      const gameSize = gameDiv.clientWidth;
      const pieceSize = gameSize / GRID_SIZE;

      // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –±–ª—é—Ä–æ–º
      const imageLayer = document.getElementById('imageLayer');
      imageLayer.style.backgroundImage = `url('${imageSrc}')`;
      imageLayer.style.filter = 'blur(18px)';

      // –°–æ–∑–¥–∞—Ç—å –≤—Å–µ –∫—É—Å–æ—á–∫–∏ –ø–∞–∑–ª–∞
      for(let row = 0; row < GRID_SIZE; row++) {
        for(let col = 0; col < GRID_SIZE; col++) {
          const piece = document.createElement('div');
          piece.className = 'piece';

          // –†–∞–∑–º–µ—Ä –∫—É—Å–æ—á–∫–∞
          piece.style.width = pieceSize + 'px';
          piece.style.height = pieceSize + 'px';

          // –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Å–æ—á–∫–∞
          piece.style.backgroundImage = `url('${imageSrc}')`;

          // –ü–æ–∑–∏—Ü–∏—è —Ñ–æ–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –∫—É—Å–æ—á–∫–∞ (–æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å —á–∞—Å—Ç—å –±–æ–ª—å—à–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
          piece.style.backgroundPosition = 
            `${-col * pieceSize}px ${-row * pieceSize}px`;

          // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –∫—É—Å–æ—á–∫–∞
          const correctX = col * pieceSize;
          const correctY = row * pieceSize;
          piece.dataset.correctX = correctX;
          piece.dataset.correctY = correctY;

          // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª—É—á–∞–π–Ω—É—é –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
          piece.style.left = Math.random() * (gameSize - pieceSize) + 'px';
          piece.style.top = Math.random() * (gameSize - pieceSize) + 'px';

          // –ü–æ–¥–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ drag & drop
          attachDragHandlers(piece);

          // –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –º–∞—Å—Å–∏–≤
          gameDiv.appendChild(piece);
          pieces.push(piece);
        }
      }
    }

    // ===== DRAG & DROP =====
    function attachDragHandlers(piece) {
      piece.addEventListener('pointerdown', (e) => {
        activePiece = piece;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        piece.setPointerCapture(e.pointerId);
      });

      piece.addEventListener('pointermove', (e) => {
        if(activePiece !== piece) return;

        const gameDiv = document.getElementById('game');
        const gameRect = gameDiv.getBoundingClientRect();
        const pieceSize = piece.clientWidth;

        let newX = e.clientX - gameRect.left - offsetX;
        let newY = e.clientY - gameRect.top - offsetY;

        // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        newX = Math.max(0, Math.min(gameRect.width - pieceSize, newX));
        newY = Math.max(0, Math.min(gameRect.height - pieceSize, newY));

        piece.style.left = newX + 'px';
        piece.style.top = newY + 'px';
      });

      piece.addEventListener('pointerup', () => {
        activePiece = null;
        snapToPlace(piece);
        checkVictory();
      });
    }

    // ===== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ü–†–ò–õ–ò–ü–ê–ù–ò–ï =====
    function snapToPlace(piece) {
      const correctX = parseFloat(piece.dataset.correctX);
      const correctY = parseFloat(piece.dataset.correctY);
      const currentX = parseFloat(piece.style.left);
      const currentY = parseFloat(piece.style.top);

      // –ï—Å–ª–∏ –±–ª–∏–∑–∫–æ –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ - –ø—Ä–∏–ª–∏–ø–Ω—É—Ç—å
      if(Math.abs(currentX - correctX) < SNAP_DISTANCE && 
         Math.abs(currentY - correctY) < SNAP_DISTANCE) {
        piece.style.left = correctX + 'px';
        piece.style.top = correctY + 'px';
        piece.style.pointerEvents = 'none'; // –û—Ç–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
      }
    }

    // ===== –ü–†–û–í–ï–†–ö–ê –ü–û–ë–ï–î–´ =====
    function checkVictory() {
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—Ä–∞–Ω—ã –ª–∏ –≤—Å–µ –∫—É—Å–∫–∏
      const allSnapped = pieces.every(p => p.style.pointerEvents === 'none');

      if(allSnapped) {
        // –£–±—Ä–∞—Ç—å –±–ª—é—Ä
        const imageLayer = document.getElementById('imageLayer');
        imageLayer.style.filter = 'blur(0px)';

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
        setTimeout(() => {
          alert('üéâ –ü–∞–∑–ª —Å–æ–±—Ä–∞–Ω! –í—ã –ø–æ–±–µ–¥–∏–ª–∏!');
        }, 600);
      }
    }
  </script>
</body>
</html>
